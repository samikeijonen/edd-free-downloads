jQuery(document.body).ready(function(e){"use strict";function d(){e(".edd-free-downloads-modal-wrapper").fadeOut(250),e("#edd-free-downloads-modal").hide().html(""),e("body").removeClass("edd-frozen")}function a(a){var o=[],r=a.parent().parent().find('input[name="edd_free_download_id"]').val();r||(r=a.parent().parent().find(".edd-free-download").data("download-id")),r||(r=a.data("download-id")),a.parent().parent().find('input[name="edd_free_download_price_id[]"]').length>0?a.parent().parent().find('input[name="edd_free_download_price_id[]"]').each(function(){o.push(e(this).val().toString())}):a.parent().parent().find('input[name="edd_options[price_id][]"]:checked').length>0&&a.parent().parent().find('input[name="edd_options[price_id][]"]:checked').each(function(){o.push(e(this).val().toString())});var n=window.location.href;-1!==n.indexOf("?")?n+="&":n+="?",isMobile.any||d(),window.location=n+"edd_action=free_downloads_process_download&download_id="+r+"&price_ids="+o}var o=e(document.body);if(e('input[name="edd_options[price_id][]"]').length>0){var r,n,s,i,l,t;if(!(r=e(".edd_purchase_submit_wrapper").find("a.edd-add-to-cart").attr("class")))return;r=r.replace("edd-add-to-cart",""),t=isMobile.any?edd_free_downloads_vars.mobile_url:"#edd-free-download-modal","1"===edd_free_downloads_vars.has_ajax?(n='<div class="edd-free-downloads-variable-wrapper">',s='<a class="edd-free-downloads-variable edd-free-download '+r+'" href="'+t+'" data-download-id=""><span>',i="</span></a>",l="</div>"):(n="",s='<input type="submit" class="edd-free-downloads-variable edd-free-download '+r+'" name="edd_purchase_download" value="',i='" href="'+t+'" data-download-id="" />',l=""),e(".edd_purchase_submit_wrapper").each(function(d){if("yes"===e(".edd_purchase_submit_wrapper").eq(d).find(".edd-add-to-cart").data("variable-price")){var a=e(this).closest("form").attr("id").replace("edd_purchase_","");if("true"===edd_free_downloads_vars.bypass_logged_in?e(this).after(n+'<a href="#" class="edd-free-downloads-direct-download-link '+r+'" data-download-id="'+a+'">'+edd_free_downloads_vars.download_label+"</a>"+l):e(this).after(n+s+edd_free_downloads_vars.download_label+i+l),e(this).parent().find(".edd-free-downloads-variable").attr("data-download-id",a),"0.00"===e(this).prev().find('input[name="edd_options[price_id][]"]:checked').attr("data-price")){var o=e(this).parent().find(".edd-free-downloads-variable").attr("href"),t=e(this).prev().find('input[name="edd_options[price_id][]"]:checked').val();e(this).css("display","none"),e(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","block"),e(this).parent().find(".edd-free-downloads-variable").attr("href",o+"&download_id="+a+"&price_ids="+t)}else"0.00"===e(this).prev().find('input[name="edd_options[price_id][]"]:checked').attr("data-price")?(e(this).css("display","none"),e(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","block")):(e(this).css("display","block"),e(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","none"))}}),o.on("change",'input[name="edd_options[price_id][]"]',function(){var d=0,a=0,o=0,r=e(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href"),n=e(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").find(".edd-add-to-cart").attr("data-download-id");e(this).closest("ul").find('input[name="edd_options[price_id][]"]').each(function(){e(this).is(":checked")&&(d+=parseFloat(e(this).attr("data-price")),a+=1,o=e(this).val())}),0!==a&&0===d?(e(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").css("display","none"),e(this).closest(".edd_download_purchase_form").find(".edd-free-downloads-variable-wrapper").css("display","block"),e(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href",r+"&download_id="+n+"&price_ids="+o)):(e(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").css("display","block"),e(this).closest(".edd_download_purchase_form").find(".edd-free-downloads-variable-wrapper").css("display","none"),e(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href",r))}),e(document.body).on("click",".edd-free-downloads-variable",function(e){e.preventDefault()})}isMobile.any?(o.on("click","a.edd-free-download",function(d){d.preventDefault(),e('input[name="edd_free_download_email"]').focus(),e('input[name="edd_free_download_email"]').select(),window.location.href=e(this).attr("href")}),o.on("click",".edd-free-download-cancel",function(){return parent.history.back(),!1})):o.on("click","a.edd-free-download",function(){var r=e(this).data("download-id"),n=[],s=e(this).parent().parent().find('input[name="edd_options[price_id][]"]');s.length>0&&s.each(function(){e(this).parent().parent().find('input[name="edd_options[price_id][]"]').each(function(){(e(this).prop("checked")||"hidden"===e(this).attr("type"))&&n.push(e(this).val().toString())})});var i=e(".edd-free-downloads-modal-wrapper");i.fadeIn(250),e.ajax({url:edd_free_downloads_vars.ajaxurl,type:"GET",data:{action:"edd_free_downloads_get_modal",download_id:r,price_ids:n,edd_is_mobile:edd_free_downloads_vars.edd_is_mobile,require_name:edd_free_downloads_vars.require_name,success_page:edd_free_downloads_vars.success_page},success:function(r){o.addClass("edd-frozen");var n=e("#edd-free-downloads-modal");n.prepend(r).fadeIn(250),e(".edd-free-downloads-modal-wrapper .edd-free-downloads-modal-close").on("click",function(){d()}),n.find("input").first().focus(),n.on("click",".edd-free-download-submit",function(a){var o=0,r=i.find('input[name="edd_free_download_email"]'),n=/^((([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/;if(""===r.val()?(e(".edd-free-download-errors").show(),e("#edd-free-download-error-email-required").css("display","block"),o++,a.preventDefault()):(e("#edd-free-download-error-email-required").css("display","none"),n.test(r.val())?e("#edd-free-download-error-email-invalid").css("display","none"):(e(".edd-free-download-errors").show(),e("#edd-free-download-error-email-invalid").css("display","block"),o++,a.preventDefault())),"true"===edd_free_downloads_vars.require_name){var s=e('.edd-free-downloads-modal-wrapper input[name="edd_free_download_fname"]'),l=e('.edd-free-downloads-modal-wrapper input[name="edd_free_download_lname"]');""===s.val()?(e(".edd-free-download-errors").show(),e("#edd-free-download-error-fname-required").css("display","block"),o++,a.preventDefault()):e("#edd-free-download-error-fname-required").css("display","none"),""===l.val()?(e(".edd-free-download-errors").show(),e("#edd-free-download-error-lname-required").css("display","block"),o++,a.preventDefault()):e("#edd-free-download-error-lname-required").css("display","none")}if("true"===edd_free_downloads_vars.user_registration){var t,f,c,u;t=e('input[name="edd_free_download_username"]'),f=e('input[name="edd_free_download_pass"]'),c=e('input[name="edd_free_download_pass2"]'),u="1"===edd_free_downloads_vars.guest_checkout_disabled,""===t.val()&&u&&(e("#edd-free-download-error-username-required").css("display","block"),o++),""!==f.val()||!u&&""===t.val()||(e("#edd-free-download-error-password-required").css("display","block"),o++),""!==c.val()||!u&&""===t.val()||(e("#edd-free-download-error-password2-required").css("display","block"),o++),""!==f.val()&&""!==c.val()&&(f.val()===c.val()||!u&&""===t.val()?e("#edd-free-download-error-password-unmatch").css("display","none"):(e("#edd-free-download-error-password-unmatch").css("display","block"),o++))}if(0===o)if("1"===edd_free_downloads_vars.email_verification){a.preventDefault();var p=e("#edd_free_download_form").serialize();e.ajax({url:edd_free_downloads_vars.ajaxurl,type:"POST",data:p,success:function(d){e(".edd-free-downloads-verification-message").html(d.message).fadeIn(),e(".edd-free-downloads-verification-message-wrapper").removeClass("edd-alert-info"),d.success?(e(".edd-free-downloads-verification-message-wrapper").addClass("edd-alert-success",250),e(".edd-free-download-submit").hide()):e(".edd-free-downloads-verification-message-wrapper").addClass("edd-alert-error",250)}})}else e("#edd_free_download_form").submit(),e(".edd-free-download-submit span").html(edd_free_downloads_vars.download_loading),e(".edd-free-download-submit span").append('<i class="edd-icon-spinner edd-icon-spin"></i>'),e(".edd-free-download-submit").attr("disabled","disabled"),"default"!=edd_free_downloads_vars.on_complete_handler&&"redirect"!=edd_free_downloads_vars.on_complete_handler&&setTimeout(function(){d()},edd_free_downloads_vars.on_complete_delay);else e(".edd-free-download-errors").css("display","block"),e(".edd-free-download-submit").removeAttr("disabled"),a.preventDefault()}),e("#edd-free-downloads-modal").on("click","a.edd-free-downloads-direct-download-link",function(d){d.preventDefault(),a(e(this))}),e("#edd-free-downloads-modal").on("click",function(e){e.stopPropagation()}),e("#edd-free-downloads-modal").parent(".edd-free-downloads-modal-wrapper").on("click",function(){d()}),o.on("keypress",".edd-free-download-field",function(d){if(13===d.which)return e(".edd-free-download-submit").click(),!1}),o.on("keyup",function(e){27===e.keyCode&&d()})}})}),o.on("click","a.edd-free-downloads-direct-download-link",function(d){d.preventDefault(),a(e(this))})});
