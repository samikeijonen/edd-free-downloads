jQuery(document.body).ready(function(a){"use strict";function b(){a(".edd-free-downloads-modal-wrapper").fadeOut(250),a("#edd-free-downloads-modal").hide().html(""),a("body").removeClass("edd-frozen")}function c(c){var d=[],e=c.parent().parent().find('input[name="edd_free_download_id"]').val();e||(e=c.parent().parent().find(".edd-free-download").data("download-id")),e||(e=c.data("download-id")),c.parent().parent().find('input[name="edd_free_download_price_id[]"]').length>0?c.parent().parent().find('input[name="edd_free_download_price_id[]"]').each(function(){d.push(a(this).val().toString())}):c.parent().parent().find('input[name="edd_options[price_id][]"]:checked').length>0&&c.parent().parent().find('input[name="edd_options[price_id][]"]:checked').each(function(){d.push(a(this).val().toString())});var f=window.location.href;f+=-1!==f.indexOf("?")?"&":"?",isMobile.any||b(),window.location=f+"edd_action=free_downloads_process_download&download_id="+e+"&price_ids="+d}var d=a(document.body);if(a('input[name="edd_options[price_id][]"]').length>0){var e,f,g,h,i,j;if(e=a(".edd_purchase_submit_wrapper").find("a.edd-add-to-cart").attr("class"),!e)return;e=e.replace("edd-add-to-cart",""),j=isMobile.any?edd_free_downloads_vars.mobile_url:"#edd-free-download-modal","1"===edd_free_downloads_vars.has_ajax?(f='<div class="edd-free-downloads-variable-wrapper">',g='<a class="edd-free-downloads-variable edd-free-download '+e+'" href="'+j+'" data-download-id=""><span>',h="</span></a>",i="</div>"):(f="",g='<input type="submit" class="edd-free-downloads-variable edd-free-download '+e+'" name="edd_purchase_download" value="',h='" href="'+j+'" data-download-id="" />',i=""),a(".edd_purchase_submit_wrapper").each(function(b){if("yes"===a(".edd_purchase_submit_wrapper").eq(b).find(".edd-add-to-cart").data("variable-price")){var c=a(this).closest("form").attr("id").replace("edd_purchase_","");if("true"===edd_free_downloads_vars.bypass_logged_in?a(this).after(f+'<a href="#" class="edd-free-downloads-direct-download-link '+e+'" data-download-id="'+c+'">'+edd_free_downloads_vars.download_label+"</a>"+i):a(this).after(f+g+edd_free_downloads_vars.download_label+h+i),a(this).parent().find(".edd-free-downloads-variable").attr("data-download-id",c),"0.00"===a(this).prev().find('input[name="edd_options[price_id][]"]:checked').attr("data-price")){var d=a(this).parent().find(".edd-free-downloads-variable").attr("href"),j=a(this).prev().find('input[name="edd_options[price_id][]"]:checked').val();a(this).css("display","none"),a(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","block"),a(this).parent().find(".edd-free-downloads-variable").attr("href",d+"&download_id="+c+"&price_ids="+j)}else"0.00"===a(this).prev().find('input[name="edd_options[price_id][]"]:checked').attr("data-price")?(a(this).css("display","none"),a(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","block")):(a(this).css("display","block"),a(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","none"))}}),d.on("change",'input[name="edd_options[price_id][]"]',function(){var b=0,c=0,d=0,e=a(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href"),f=a(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").find(".edd-add-to-cart").attr("data-download-id");a(this).closest("ul").find('input[name="edd_options[price_id][]"]').each(function(){a(this).is(":checked")&&(b+=parseFloat(a(this).attr("data-price")),c+=1,d=a(this).val())}),0!==c&&0===b?(a(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").css("display","none"),a(this).closest(".edd_download_purchase_form").find(".edd-free-downloads-variable-wrapper").css("display","block"),a(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href",e+"&download_id="+f+"&price_ids="+d)):(a(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").css("display","block"),a(this).closest(".edd_download_purchase_form").find(".edd-free-downloads-variable-wrapper").css("display","none"),a(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href",e))}),a(document.body).on("click",".edd-free-downloads-variable",function(a){a.preventDefault()})}isMobile.any?(d.on("click","a.edd-free-download",function(b){b.preventDefault(),a('input[name="edd_free_download_email"]').focus(),a('input[name="edd_free_download_email"]').select(),window.location.href=a(this).attr("href")}),d.on("click",".edd-free-download-cancel",function(){return parent.history.back(),!1})):d.on("click","a.edd-free-download",function(){var e=a(this).data("download-id"),f=[],g=a(this).parent().parent().find('input[name="edd_options[price_id][]"]');g.length>0&&g.each(function(){a(this).parent().parent().find('input[name="edd_options[price_id][]"]').each(function(){(a(this).prop("checked")||"hidden"===a(this).attr("type"))&&f.push(a(this).val().toString())})});var h=a(".edd-free-downloads-modal-wrapper");h.fadeIn(250),a.ajax({url:edd_free_downloads_vars.ajaxurl,type:"GET",data:{action:"edd_free_downloads_get_modal",download_id:e,price_ids:f,edd_is_mobile:edd_free_downloads_vars.edd_is_mobile,require_name:edd_free_downloads_vars.require_name,success_page:edd_free_downloads_vars.success_page},success:function(e){d.addClass("edd-frozen");var f=a("#edd-free-downloads-modal");f.prepend(e).fadeIn(250),a(".edd-free-downloads-modal-wrapper .edd-free-downloads-modal-close").on("click",function(){b()}),f.find("input").first().focus(),f.on("click",".edd-free-download-submit",function(c){var d=0,e=h.find('input[name="edd_free_download_email"]'),f=/^((([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/;if(""===e.val()?(a(".edd-free-download-errors").show(),a("#edd-free-download-error-email-required").css("display","block"),d++,c.preventDefault()):(a("#edd-free-download-error-email-required").css("display","none"),f.test(e.val())?a("#edd-free-download-error-email-invalid").css("display","none"):(a(".edd-free-download-errors").show(),a("#edd-free-download-error-email-invalid").css("display","block"),d++,c.preventDefault())),"true"===edd_free_downloads_vars.require_name){var g=a('.edd-free-downloads-modal-wrapper input[name="edd_free_download_fname"]'),i=a('.edd-free-downloads-modal-wrapper input[name="edd_free_download_lname"]');""===g.val()?(a(".edd-free-download-errors").show(),a("#edd-free-download-error-fname-required").css("display","block"),d++,c.preventDefault()):a("#edd-free-download-error-fname-required").css("display","none"),""===i.val()?(a(".edd-free-download-errors").show(),a("#edd-free-download-error-lname-required").css("display","block"),d++,c.preventDefault()):a("#edd-free-download-error-lname-required").css("display","none")}if("true"===edd_free_downloads_vars.user_registration){var j,k,l,m;j=a('input[name="edd_free_download_username"]'),k=a('input[name="edd_free_download_pass"]'),l=a('input[name="edd_free_download_pass2"]'),m="1"===edd_free_downloads_vars.guest_checkout_disabled,""===j.val()&&m&&(a("#edd-free-download-error-username-required").css("display","block"),d++),""!==k.val()||!m&&""===j.val()||(a("#edd-free-download-error-password-required").css("display","block"),d++),""!==l.val()||!m&&""===j.val()||(a("#edd-free-download-error-password2-required").css("display","block"),d++),""!==k.val()&&""!==l.val()&&(k.val()===l.val()||!m&&""===j.val()?a("#edd-free-download-error-password-unmatch").css("display","none"):(a("#edd-free-download-error-password-unmatch").css("display","block"),d++))}if(0===d)if("1"===edd_free_downloads_vars.email_verification){c.preventDefault();var n=a("#edd_free_download_form").serialize();a.ajax({url:edd_free_downloads_vars.ajaxurl,type:"POST",data:n,success:function(b){a(".edd-free-downloads-verification-message").html(b.message).fadeIn(),a(".edd-free-downloads-verification-message-wrapper").removeClass("edd-alert-info"),b.success?(a(".edd-free-downloads-verification-message-wrapper").addClass("edd-alert-success",250),a(".edd-free-download-submit").hide()):a(".edd-free-downloads-verification-message-wrapper").addClass("edd-alert-error",250)}})}else a("#edd_free_download_form").submit(),a(".edd-free-download-submit span").html(edd_free_downloads_vars.download_loading),a(".edd-free-download-submit span").append('<i class="edd-icon-spinner edd-icon-spin"></i>'),a(".edd-free-download-submit").attr("disabled","disabled"),b();else a(".edd-free-download-errors").css("display","block"),a(".edd-free-download-submit").removeAttr("disabled"),c.preventDefault()}),a("#edd-free-downloads-modal").on("click","a.edd-free-downloads-direct-download-link",function(b){b.preventDefault(),c(a(this))}),a("#edd-free-downloads-modal").on("click",function(a){a.stopPropagation()}),a("#edd-free-downloads-modal").parent(".edd-free-downloads-modal-wrapper").on("click",function(){b()}),d.on("keypress",".edd-free-download-field",function(b){return 13===b.which?(a(".edd-free-download-submit").click(),!1):void 0}),d.on("keyup",function(a){27===a.keyCode&&b()})}})}),d.on("click","a.edd-free-downloads-direct-download-link",function(b){b.preventDefault(),c(a(this))})});